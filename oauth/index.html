<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="referrer" content="never">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <title>Cookie test</title>
  <style>
  body {
    padding-top: 5rem;
  }
  .starter-template {
    padding: 3rem 1.5rem;
  }</style>
</head>
<body>
  <main role="main" class="container">

    <div class="starter-template">
      <h2>Test Flows</h2>

    <h3>Step 1: Login from an iframe and redirect</h3>
    <ol>
      <li>You are on a given domain for Site A (here <code>madmath.github.io</code>)</li>
      <li>You encounter a login iframe for <code>posh.app</code>. You prove your identity to <code>posh.app</code> in a secure way.</li>
      <li>You bounce through <code>posh.app</code> in a top-level manner <b>very quickly</b>, which allows it to set a server cookie.</li>
      <li>It passes on that value to the redirected domain as a parameter (check the URL bar).</li>
      <li>Click "back" to do Step 2 below ðŸ˜‰</li>
    </ol>
    <iframe src="https://app.tornadored.com/cookies/iframe" ></iframe>
    <br/>
    <h3>Step 2: Check login state and redirect</h3>
    <ol>
      <li>You are on a given domain for Site A (here <code>madmath.github.io</code>)</li>
      <li>You encounter a checkout button for <code>posh.app</code>.</li>
      <li>It <b>briefly</b> redirects you to <code>posh.app</code>, checks your cookie and passes it on to a new store.</li>
      <li>You are now logged in "across stores" via <code>posh.app</code>.</li>
    </ol>
    <a class="btn btn-primary btn-lg" href="https://app.tornadored.com/cookies/checkandredirect" role="button">Checkout with posh.app Â»</a>
  </main><!-- /.container -->
  <footer class="container">
    <p>Note: I don't own the <code>posh.app</code> domain so I substitute it with another domain I own.</p>
  </footer>
</body>
<script type="text/javascript">
  window.addEventListener("message", (event) => {
    if (event.origin !== "https://app.tornadored.com")
      return;

    window.location = "https://app.tornadored.com/cookies/setandredirect?smscode=" + event.data;
  }, false);
</script>
</html>